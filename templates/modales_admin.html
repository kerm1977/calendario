<!-- ========================================== -->
<!-- 2. MODALES DE ADMINISTRACIÓN (ADMIN) -->
<!-- ========================================== -->
<!-- Herramientas de gestión: Editar y Eliminar -->

{% if current_user.is_authenticated and current_user.is_superuser %}
    <!-- MODAL DE EDICIÓN -->
    <div class="modal fade" id="editModal{{ event.id }}" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <form class="modal-content border-0 shadow-lg rounded-5 overflow-hidden" action="{{ url_for('calendar_view.edit_event', event_id=event.id) }}" method="POST" enctype="multipart/form-data">
                <div class="modal-header bg-warning text-dark border-0 py-3">
                    <h5 class="modal-title fw-bold"><i class="bi bi-pencil-square me-2"></i>Editar Actividad</h5>
                    <button type="button" class="btn-close shadow-none" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4 p-md-5 bg-body">
                    <div class="row g-4">
                        <!-- Sección 1 -->
                        <div class="col-md-12"><h6 class="border-bottom pb-2 fw-bold text-warning text-uppercase small">1. Información General</h6></div>
                        <div class="col-md-6">
                            <label class="form-label small fw-bold text-secondary">Imagen del Evento</label>
                            <input type="file" name="flyer" class="form-control border-warning bg-body shadow-none" accept="image/*">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small fw-bold text-secondary">Nombre de la Aventura</label>
                            <input type="text" name="title" class="form-control border-warning bg-body" value="{{ event.title }}" required>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label small fw-bold text-secondary">Moneda</label>
                            <select name="currency" class="form-select border-warning bg-body">
                                <option value="¢" {% if event.currency == '¢' %}selected{% endif %}>¢ Colones</option>
                                <option value="$" {% if event.currency == '$' %}selected{% endif %}>$ Dólares</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label small fw-bold text-secondary">Precio</label>
                            <input type="number" step="0.01" name="price" class="form-control border-warning bg-body" value="{{ event.price }}">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label small fw-bold text-secondary">Puntos</label>
                            <input type="number" name="points_reward" class="form-control border-warning bg-body" value="{{ event.points_reward or 10 }}">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label small fw-bold text-secondary">Tipo</label>
                            <select name="activity_type" class="form-select border-warning bg-body">
                                {% for type in ['Caminata', 'El Camino de Costa Rica', 'Parque Nacional', 'Internacional', 'Convivio', 'Taller'] %}
                                <option {% if event.activity_type == type %}selected{% endif %}>{{ type }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- Sección 2 -->
                        <div class="col-md-12 mt-5"><h6 class="border-bottom pb-2 fw-bold text-warning text-uppercase small">2. Calendario</h6></div>
                        <div class="col-md-4">
                            <label class="form-label small fw-bold text-secondary">Días (1-10)</label>
                            <input type="number" name="duration_days" class="form-control border-warning bg-body edit-duration-input" data-event-id="{{ event.id }}" min="1" max="10" value="{{ event.duration_days }}">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label small fw-bold text-secondary edit-label-date" data-event-id="{{ event.id }}">{% if event.duration_days > 1 %}Fecha Inicio{% else %}Fecha Actividad{% endif %}</label>
                            <input type="date" name="event_date" class="form-control border-warning bg-body" value="{{ event.event_date }}" required>
                        </div>
                        <div class="col-md-4 {% if event.duration_days <= 1 %}d-none{% endif %} edit-end-date-container" data-event-id="{{ event.id }}">
                            <label class="form-label small fw-bold text-secondary">Fecha Cierre</label>
                            <input type="date" name="end_date" class="form-control border-warning bg-body" value="{{ event.end_date }}">
                        </div>

                        <!-- Sección 3 -->
                        <div class="col-md-12 mt-5"><h6 class="border-bottom pb-2 fw-bold text-warning text-uppercase small">3. Logística</h6></div>
                        <div class="col-md-6">
                            <label class="form-label small fw-bold text-secondary">Lugar de Salida</label>
                            <input type="text" name="departure_point" class="form-control border-warning bg-body" value="{{ event.departure_point }}">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label small fw-bold text-secondary">Hora Salida</label>
                            <input type="time" name="departure_time" class="form-control border-warning bg-body" value="{{ event.departure_time }}">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label small fw-bold text-secondary">Dificultad</label>
                            <select name="difficulty" class="form-select border-warning bg-body">
                                {% for d in ['Básica', 'Paseo', 'Intermedio', 'Dificil', 'Avanzado'] %}
                                <option {% if event.difficulty == d %}selected{% endif %}>{{ d }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-4"><label class="form-label small fw-bold text-secondary">Distancia</label><input type="text" name="distance" class="form-control border-warning bg-body" value="{{ event.distance }}"></div>
                        <div class="col-md-4"><label class="form-label small fw-bold text-secondary">Capacidad</label><input type="number" name="capacity" class="form-control border-warning bg-body" value="{{ event.capacity }}"></div>
                        <div class="col-md-4"><label class="form-label small fw-bold text-secondary">Monto Reserva</label><input type="text" name="reservation_fee" class="form-control border-warning bg-body" value="{{ event.reservation_fee }}"></div>

                        <div class="col-12"><label class="form-label small fw-bold text-secondary">Descripción Detallada</label><textarea name="description" class="form-control border-warning bg-body" rows="6">{{ event.description }}</textarea></div>

                        <!-- Sección 4 -->
                        <div class="col-md-12 mt-5"><h6 class="border-bottom pb-2 fw-bold text-warning text-uppercase small">4. Estado</h6></div>
                        <div class="col-md-6">
                            <label class="form-label small fw-bold text-secondary">Estado de Publicación</label>
                            <select name="status" class="form-select border-warning bg-body edit-status-select" data-event-id="{{ event.id }}">
                                <option value="Activa" {% if event.status == 'Activa' %}selected{% endif %}>Activa</option>
                                <option value="Suspendido" {% if event.status == 'Suspendido' %}selected{% endif %}>Suspendido</option>
                                <option value="Se Traslado" {% if event.status == 'Se Traslado' %}selected{% endif %}>Se Traslado</option>
                            </select>
                        </div>
                        <div class="col-md-6 {% if event.status != 'Se Traslado' %}d-none{% endif %} edit-moved-date-container" data-event-id="{{ event.id }}">
                            <label class="form-label small fw-bold text-secondary">Nueva Fecha</label>
                            <input type="date" name="moved_date" class="form-control border-warning bg-body" value="{{ event.moved_date }}">
                        </div>
                    </div>
                </div>
                <div class="modal-footer bg-light border-0 py-3">
                    <button type="button" class="btn btn-secondary rounded-pill px-4 fw-bold" data-bs-dismiss="modal">Cerrar</button>
                    <button type="submit" class="btn btn-warning fw-bold text-dark rounded-pill px-5 shadow">Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL DE ELIMINACIÓN -->
    <div class="modal fade" id="deleteModal{{ event.id }}" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg rounded-5 overflow-hidden">
                <div class="modal-header bg-danger text-white border-0 py-3 text-center d-block">
                    <h5 class="modal-title fw-bold"><i class="bi bi-shield-fill-exclamation me-2"></i>Confirmación Crítica</h5>
                    <button type="button" class="btn-close btn-close-white position-absolute top-0 end-0 m-4 shadow-none" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-5 text-center">
                    <div class="mb-4"><i class="bi bi-trash-fill text-danger display-1 opacity-10"></i></div>
                    <h4 class="fw-bold mb-3">¿Borrar esta actividad?</h4>
                    <p class="text-secondary px-3">Estás a punto de eliminar permanentemente la aventura:<br><strong>"{{ event.title }}"</strong>.</p>
                    <div class="bg-danger bg-opacity-5 p-4 rounded-4 text-start small border border-danger border-opacity-10 mt-4 mb-4 mx-2">
                        <div class="form-check mb-3"><input class="form-check-input border-danger" type="checkbox" id="check1{{ event.id }}" onchange="validateDelete({{ event.id }})"><label class="form-check-label text-dark fw-bold" for="check1{{ event.id }}">Confirmo que es IRREVERSIBLE.</label></div>
                        <div class="form-check"><input class="form-check-input border-danger" type="checkbox" id="check2{{ event.id }}" onchange="validateDelete({{ event.id }})"><label class="form-check-label text-dark fw-bold" for="check2{{ event.id }}">Se borrarán todas las reservas asociadas.</label></div>
                    </div>
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('calendar_view.delete_event', event_id=event.id) }}" id="deleteBtn{{ event.id }}" class="btn btn-danger py-3 fw-bold rounded-pill disabled shadow-sm fs-5">ELIMINAR AHORA</a>
                        <button type="button" class="btn btn-light py-2 fw-bold text-muted rounded-pill mt-2" data-bs-dismiss="modal">CANCELAR</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endif %}